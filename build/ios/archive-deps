#!/bin/sh
set -e

# TODO(bassosimone): rename this file `./script/build/ios-archive-deps`

ROOTDIR=$(cd $(dirname $0)/../.. && pwd -P)
cd $ROOTDIR/MK_DIST

# Trim down the archive by removing everything that is not a static library
# (i.e. *.a) and is not a plain C header file (i.e. *.h).
find iphoneos -type f -not -name \*.a -a -not -name \*.h -exec rm {} \;
find iphoneos -depth -type d -empty -exec rmdir {} \;
find iphonesimulator -type f -not -name \*.a -a -not -name \*.h -exec rm {} \;
find iphonesimulator -depth -type d -empty -exec rmdir {} \;

archive=mk-ios-deps-`date +%Y%m%dT%H%M%SZ`.tar.bz2
tar -cjf $archive iphoneos iphonesimulator
$ROOTDIR/build/sign $archive
